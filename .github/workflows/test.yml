name: KMP Build Test

on: [push]

jobs:
  build-kmp:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Check Windows project structure
        run: |
          echo "üìÅ Checking project structure from Windows..."
          ls -la
          echo "üîß Gradle files:"
          find . -name "*.kts" | head -10
          echo "üì¶ Modules:"
          find . -maxdepth 2 -type d -name "*" | head -10

      - name: Fix line endings (for Windows)
        run: |
          sed -i 's/\r$//' gradlew  # Fix Windows line endings
          chmod +x ./gradlew

      - name: Test Gradle
        run: |
          ./gradlew --version || echo "Gradle check failed"

      - name: Safe build attempt
        run: |
          # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∫–∏
          ./gradlew tasks --console=plain | head -10 || echo "Cannot list tasks"
          [ -d "shared" ] && ./gradlew :shared:build || echo "No shared module"